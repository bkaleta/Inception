server {
    # Nasłuchuje na porcie 443 dla IPv4 i IPv6 z włączonym SSL/TLS
    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    # Użyj nazwy domeny z projektem Inception
    server_name bkaleta.42.fr;

    # --- KONFIGURACJA SSL ---
    # Certyfikat i klucz muszą mieć nazwy wygenerowane w Dockerfile
    ssl_certificate         /etc/nginx/ssl/bkaleta.crt;
    ssl_certificate_key     /etc/nginx/ssl/bkaleta.key;

    # Protokoły szyfrowania (TLS 1.2 i 1.3 są standardem)
    ssl_protocols           TLSv1.2 TLSv1.3;
    
    # Optymalizacja konfiguracji SSL (opcjonalne, ale zalecane)
    ssl_ciphers             "TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
    ssl_prefer_server_ciphers on;
    ssl_session_cache       shared:SSL:10m;
    ssl_session_timeout     10m;
    
    # --- PLIKI I KORZEŃ ---
    root /var/www/html;
    index index.php index.html index.htm; # Alpine używa index.html/htm, ale index.php jest najważniejszy

    # --- ROUTING OGÓLNY (Dla WordPressa) ---
    # Try_files próbuje znaleźć plik/katalog, a jeśli się nie uda, 
    # przekierowuje zapytanie do index.php (potrzebne dla ładnych linków WP).
    location / {
        try_files $uri $uri/ /index.php$is_args$args;
    }

    # --- PRZEKIEROWANIE DO PHP-FPM (WordPress) ---
    # Obsługuje wszystkie żądania kończące się na .php
    location ~ \.php$ {
        # Sprawdzanie, czy plik istnieje w katalogu korzeniowym
        try_files $uri =404;
        
        # FastCGI: przekierowanie żądania do kontenera PHP-FPM
        # Nazwa hosta 'wordpress' i port '9000' muszą pasować do kontenera PHP-FPM
        fastcgi_pass wordpress:9000;
        
        # Konfiguracja FastCGI (standardowe parametry)
        fastcgi_index index.php;
        include fastcgi_params;
        
        # Parametry wymagane przez PHP-FPM do zlokalizowania skryptu
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }
}